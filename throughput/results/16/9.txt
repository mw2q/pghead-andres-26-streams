BEGIN;
BEGIN
select
	nation,
	o_year,
	sum(amount) as sum_profit
from
	(
		select
			n_name as nation,
			extract(year from o_orderdate) as o_year,
			l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
		from
			part,
			supplier,
			lineitem,
			partsupp,
			orders,
			nation
		where
			s_suppkey = l_suppkey
			and ps_suppkey = l_suppkey
			and ps_partkey = l_partkey
			and p_partkey = l_partkey
			and o_orderkey = l_orderkey
			and s_nationkey = n_nationkey
			and p_name like '%lime%'
	) as profit
group by
	nation,
	o_year
order by
	nation,
	o_year desc;
          nation           | o_year |    sum_profit    
---------------------------+--------+------------------
 ALGERIA                   |   1998 | 267712935.145594
 ALGERIA                   |   1997 | 452238874.100995
 ALGERIA                   |   1996 | 449933754.203994
 ALGERIA                   |   1995 |  453424681.40738
 ALGERIA                   |   1994 | 459480784.193027
 ALGERIA                   |   1993 | 449771757.661532
 ALGERIA                   |   1992 | 458598329.426491
 ARGENTINA                 |   1998 | 274433348.725956
 ARGENTINA                 |   1997 | 467575730.883737
 ARGENTINA                 |   1996 | 465578565.029792
 ARGENTINA                 |   1995 | 467502819.284697
 ARGENTINA                 |   1994 | 463070006.113191
 ARGENTINA                 |   1993 | 467861922.466153
 ARGENTINA                 |   1992 |  469967851.45466
 BRAZIL                    |   1998 | 277485698.717175
 BRAZIL                    |   1997 | 473275436.579321
 BRAZIL                    |   1996 | 473742149.287704
 BRAZIL                    |   1995 | 472376824.780541
 BRAZIL                    |   1994 | 472382252.904392
 BRAZIL                    |   1993 | 481170932.617035
 BRAZIL                    |   1992 |   476844853.7115
 CANADA                    |   1998 | 277057879.258623
 CANADA                    |   1997 | 471283769.641402
 CANADA                    |   1996 | 475345021.888825
 CANADA                    |   1995 | 480705048.242274
 CANADA                    |   1994 | 475536547.360936
 CANADA                    |   1993 | 471927804.915435
 CANADA                    |   1992 | 474854506.596671
 CHINA                     |   1998 | 272254350.579585
 CHINA                     |   1997 | 458607814.267925
 CHINA                     |   1996 | 459338456.903696
 CHINA                     |   1995 | 460245140.513254
 CHINA                     |   1994 | 466012609.566572
 CHINA                     |   1993 |  455309901.84341
 CHINA                     |   1992 | 467712025.310701
 EGYPT                     |   1998 |  280246746.07471
 EGYPT                     |   1997 | 476901693.029924
 EGYPT                     |   1996 | 478782890.630011
 EGYPT                     |   1995 | 476824243.429015
 EGYPT                     |   1994 | 474826374.240246
 EGYPT                     |   1993 | 480094871.304446
 EGYPT                     |   1992 | 477871924.493601
 ETHIOPIA                  |   1998 |  263750787.46658
 ETHIOPIA                  |   1997 | 451203869.584674
 ETHIOPIA                  |   1996 | 449597138.662167
 ETHIOPIA                  |   1995 | 452171547.866495
 ETHIOPIA                  |   1994 | 450631088.170783
 ETHIOPIA                  |   1993 | 451593240.320755
 ETHIOPIA                  |   1992 | 452219504.310669
 FRANCE                    |   1998 | 280533857.231101
 FRANCE                    |   1997 | 462295177.367104
 FRANCE                    |   1996 | 472445721.585087
 FRANCE                    |   1995 |  461427520.21369
 FRANCE                    |   1994 | 469346132.439226
 FRANCE                    |   1993 | 467102964.903563
 FRANCE                    |   1992 | 468593574.294375
 GERMANY                   |   1998 | 267458647.481251
 GERMANY                   |   1997 |  467310856.18227
 GERMANY                   |   1996 | 467819271.740543
 GERMANY                   |   1995 | 464476702.267979
 GERMANY                   |   1994 | 460520670.066043
 GERMANY                   |   1993 | 471325740.337589
 GERMANY                   |   1992 | 464859974.906413
 INDIA                     |   1998 |  271028385.13594
 INDIA                     |   1997 | 468996445.488423
 INDIA                     |   1996 | 484521199.785968
 INDIA                     |   1995 |  469294927.37743
 INDIA                     |   1994 | 476046379.210447
 INDIA                     |   1993 | 481305238.857079
 INDIA                     |   1992 | 479285687.741348
 INDONESIA                 |   1998 | 264784573.387219
 INDONESIA                 |   1997 | 457409526.497488
 INDONESIA                 |   1996 | 465627328.545585
 INDONESIA                 |   1995 | 459756239.977456
 INDONESIA                 |   1994 | 457872130.911068
 INDONESIA                 |   1993 | 464719705.907134
 INDONESIA                 |   1992 | 462772566.029285
 IRAN                      |   1998 | 269974705.996448
 IRAN                      |   1997 | 461069456.030262
 IRAN                      |   1996 | 474078972.111021
 IRAN                      |   1995 | 461861856.436279
 IRAN                      |   1994 |  459390179.65179
 IRAN                      |   1993 | 464630121.989594
 IRAN                      |   1992 | 468109852.077955
 IRAQ                      |   1998 | 271633086.106671
 IRAQ                      |   1997 | 467575860.636879
 IRAQ                      |   1996 | 465653418.746202
 IRAQ                      |   1995 | 460286691.218486
 IRAQ                      |   1994 | 469106999.017896
 IRAQ                      |   1993 | 464995307.950412
 IRAQ                      |   1992 | 467195076.244635
 JAPAN                     |   1998 | 272084388.362323
 JAPAN                     |   1997 | 456883867.988219
 JAPAN                     |   1996 | 467919374.432212
 JAPAN                     |   1995 | 461855680.166995
 JAPAN                     |   1994 | 463421151.646859
 JAPAN                     |   1993 | 468541602.988122
 JAPAN                     |   1992 | 463312110.299052
 JORDAN                    |   1998 | 264597038.198052
 JORDAN                    |   1997 | 462080850.167189
 JORDAN                    |   1996 | 455146969.081496
 JORDAN                    |   1995 | 454214037.217918
 JORDAN                    |   1994 | 454195912.272882
 JORDAN                    |   1993 |  459250068.98012
 JORDAN                    |   1992 | 458126187.546414
 KENYA                     |   1998 | 277690988.913681
 KENYA                     |   1997 | 481196417.682241
 KENYA                     |   1996 | 472347792.437489
 KENYA                     |   1995 | 474000095.794553
 KENYA                     |   1994 | 467076965.535124
 KENYA                     |   1993 | 466479579.698735
 KENYA                     |   1992 | 472492104.149366
 MOROCCO                   |   1998 |  271965205.97862
 MOROCCO                   |   1997 |  463667873.85663
 MOROCCO                   |   1996 | 464781905.075922
 MOROCCO                   |   1995 | 463355192.738156
 MOROCCO                   |   1994 | 463052982.983738
 MOROCCO                   |   1993 | 470772910.789686
 MOROCCO                   |   1992 |  459479321.45372
 MOZAMBIQUE                |   1998 | 271730725.601394
 MOZAMBIQUE                |   1997 | 453050948.730369
 MOZAMBIQUE                |   1996 | 456442969.380791
 MOZAMBIQUE                |   1995 | 462461164.892424
 MOZAMBIQUE                |   1994 | 461766132.866727
 MOZAMBIQUE                |   1993 | 459984434.324848
 MOZAMBIQUE                |   1992 | 461779284.887803
 PERU                      |   1998 | 271203529.398372
 PERU                      |   1997 | 466986107.982879
 PERU                      |   1996 | 467596139.010439
 PERU                      |   1995 | 462205019.094974
 PERU                      |   1994 | 460257263.177673
 PERU                      |   1993 | 463345699.224914
 PERU                      |   1992 | 467695375.965093
 ROMANIA                   |   1998 | 269982728.626584
 ROMANIA                   |   1997 |  461090260.94071
 ROMANIA                   |   1996 | 470994087.493913
 ROMANIA                   |   1995 | 467601496.777213
 ROMANIA                   |   1994 | 455488733.303796
 ROMANIA                   |   1993 | 470792084.022602
 ROMANIA                   |   1992 | 465658076.575503
 RUSSIA                    |   1998 | 279349328.484218
 RUSSIA                    |   1997 | 480415934.289052
 RUSSIA                    |   1996 | 477878345.526283
 RUSSIA                    |   1995 | 467444865.409485
 RUSSIA                    |   1994 |  474274347.67384
 RUSSIA                    |   1993 |  475679674.21934
 RUSSIA                    |   1992 |  468702502.09221
 SAUDI ARABIA              |   1998 | 277815911.223169
 SAUDI ARABIA              |   1997 | 476501479.124348
 SAUDI ARABIA              |   1996 | 469428493.722037
 SAUDI ARABIA              |   1995 | 469878923.655832
 SAUDI ARABIA              |   1994 | 465750380.862134
 SAUDI ARABIA              |   1993 | 476112705.799887
 SAUDI ARABIA              |   1992 | 475875422.396757
 UNITED KINGDOM            |   1998 | 278013654.892003
 UNITED KINGDOM            |   1997 | 460330218.101925
 UNITED KINGDOM            |   1996 | 467752895.986825
 UNITED KINGDOM            |   1995 | 468707152.455761
 UNITED KINGDOM            |   1994 | 465523751.934286
 UNITED KINGDOM            |   1993 | 461252820.553094
 UNITED KINGDOM            |   1992 | 456865363.151932
 UNITED STATES             |   1998 | 274564294.905746
 UNITED STATES             |   1997 | 479003746.679216
 UNITED STATES             |   1996 | 466780009.766369
 UNITED STATES             |   1995 | 465711963.263165
 UNITED STATES             |   1994 |  469260982.36848
 UNITED STATES             |   1993 | 474185433.116812
 UNITED STATES             |   1992 | 463878751.822146
 VIETNAM                   |   1998 | 275884579.947802
 VIETNAM                   |   1997 | 474745931.467171
 VIETNAM                   |   1996 | 482704185.191031
 VIETNAM                   |   1995 | 469562041.055304
 VIETNAM                   |   1994 | 479759456.108061
 VIETNAM                   |   1993 | 473622838.646341
 VIETNAM                   |   1992 | 471214806.926994
(175 rows)

COMMIT;
COMMIT
