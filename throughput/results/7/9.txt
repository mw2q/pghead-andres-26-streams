BEGIN;
BEGIN
select
	nation,
	o_year,
	sum(amount) as sum_profit
from
	(
		select
			n_name as nation,
			extract(year from o_orderdate) as o_year,
			l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
		from
			part,
			supplier,
			lineitem,
			partsupp,
			orders,
			nation
		where
			s_suppkey = l_suppkey
			and ps_suppkey = l_suppkey
			and ps_partkey = l_partkey
			and p_partkey = l_partkey
			and o_orderkey = l_orderkey
			and s_nationkey = n_nationkey
			and p_name like '%blanched%'
	) as profit
group by
	nation,
	o_year
order by
	nation,
	o_year desc;
          nation           | o_year |    sum_profit    
---------------------------+--------+------------------
 ALGERIA                   |   1998 | 263443408.792001
 ALGERIA                   |   1997 | 452443737.527838
 ALGERIA                   |   1996 | 453914276.521273
 ALGERIA                   |   1995 | 455021535.623308
 ALGERIA                   |   1994 | 461768831.215376
 ALGERIA                   |   1993 | 454608409.695595
 ALGERIA                   |   1992 | 457996859.356413
 ARGENTINA                 |   1998 |   278367757.3127
 ARGENTINA                 |   1997 | 468318482.203584
 ARGENTINA                 |   1996 | 471775806.325619
 ARGENTINA                 |   1995 | 465227189.236185
 ARGENTINA                 |   1994 | 466060492.348451
 ARGENTINA                 |   1993 | 466455104.884261
 ARGENTINA                 |   1992 | 474524513.836098
 BRAZIL                    |   1998 |  271855694.28613
 BRAZIL                    |   1997 | 471295988.256766
 BRAZIL                    |   1996 | 475880436.525883
 BRAZIL                    |   1995 |  464861898.39158
 BRAZIL                    |   1994 | 465750839.838638
 BRAZIL                    |   1993 | 464747069.951669
 BRAZIL                    |   1992 | 471617737.277085
 CANADA                    |   1998 | 280589786.376796
 CANADA                    |   1997 | 467726288.680304
 CANADA                    |   1996 | 473356591.591135
 CANADA                    |   1995 | 466026765.915576
 CANADA                    |   1994 | 473431350.237978
 CANADA                    |   1993 |  483142117.71289
 CANADA                    |   1992 | 477306707.430783
 CHINA                     |   1998 | 270159202.738835
 CHINA                     |   1997 | 458519926.783737
 CHINA                     |   1996 | 456837884.333978
 CHINA                     |   1995 | 466826392.645663
 CHINA                     |   1994 | 461361373.418206
 CHINA                     |   1993 | 457228875.580587
 CHINA                     |   1992 |  457977189.31444
 EGYPT                     |   1998 | 265950548.176402
 EGYPT                     |   1997 | 466945473.010273
 EGYPT                     |   1996 | 463595941.402586
 EGYPT                     |   1995 | 470947164.070242
 EGYPT                     |   1994 | 465450310.051574
 EGYPT                     |   1993 | 468206053.373439
 EGYPT                     |   1992 | 468587896.991946
 ETHIOPIA                  |   1998 | 271294796.840278
 ETHIOPIA                  |   1997 | 449965548.673252
 ETHIOPIA                  |   1996 | 452519395.428821
 ETHIOPIA                  |   1995 | 450596994.941682
 ETHIOPIA                  |   1994 | 461731890.522613
 ETHIOPIA                  |   1993 | 456388666.060541
 ETHIOPIA                  |   1992 | 461457487.906646
 FRANCE                    |   1998 | 272794327.855899
 FRANCE                    |   1997 | 467998529.266862
 FRANCE                    |   1996 |  474598324.83174
 FRANCE                    |   1995 | 459474264.885508
 FRANCE                    |   1994 | 463446238.555327
 FRANCE                    |   1993 | 463774197.990877
 FRANCE                    |   1992 | 465836318.465823
 GERMANY                   |   1998 | 282852051.539252
 GERMANY                   |   1997 | 478727868.527673
 GERMANY                   |   1996 | 483939435.077448
 GERMANY                   |   1995 | 482928452.197586
 GERMANY                   |   1994 | 479095001.450539
 GERMANY                   |   1993 | 479196994.361108
 GERMANY                   |   1992 | 476754479.462975
 INDIA                     |   1998 | 276614589.686972
 INDIA                     |   1997 | 471103692.851262
 INDIA                     |   1996 | 474141086.615202
 INDIA                     |   1995 | 473903238.763531
 INDIA                     |   1994 |  473994379.18082
 INDIA                     |   1993 |  469556811.63391
 INDIA                     |   1992 | 484284522.138762
 INDONESIA                 |   1998 | 275821656.474808
 INDONESIA                 |   1997 | 460930985.662518
 INDONESIA                 |   1996 | 465440128.804166
 INDONESIA                 |   1995 | 468153521.662577
 INDONESIA                 |   1994 |   464506031.0795
 INDONESIA                 |   1993 | 458514554.095468
 INDONESIA                 |   1992 | 457202314.749084
 IRAN                      |   1998 | 268139375.257444
 IRAN                      |   1997 | 458346868.767494
 IRAN                      |   1996 | 460266097.696003
 IRAN                      |   1995 | 463909466.132016
 IRAN                      |   1994 | 458955561.543288
 IRAN                      |   1993 | 457374858.589239
 IRAN                      |   1992 | 463059797.549063
 IRAQ                      |   1998 | 279106076.379261
 IRAQ                      |   1997 | 466885544.447933
 IRAQ                      |   1996 | 472976997.152945
 IRAQ                      |   1995 | 468982145.386031
 IRAQ                      |   1994 | 470355335.918114
 IRAQ                      |   1993 | 464848764.820379
 IRAQ                      |   1992 | 473600673.575341
 JAPAN                     |   1998 | 275457617.430342
 JAPAN                     |   1997 | 465458077.121894
 JAPAN                     |   1996 | 465729386.781884
 JAPAN                     |   1995 | 461695350.335432
 JAPAN                     |   1994 | 458569322.710285
 JAPAN                     |   1993 | 469938985.290659
 JAPAN                     |   1992 | 457475569.682302
 JORDAN                    |   1998 |  272913704.60711
 JORDAN                    |   1997 | 464456765.076364
 JORDAN                    |   1996 | 466979567.620232
 JORDAN                    |   1995 | 462329156.835248
 JORDAN                    |   1994 | 460524397.542277
 JORDAN                    |   1993 |  458933274.53972
 JORDAN                    |   1992 | 461934095.959312
 KENYA                     |   1998 | 274178741.330673
 KENYA                     |   1997 | 470400356.821766
 KENYA                     |   1996 |  476815891.84259
 KENYA                     |   1995 | 466714163.122043
 KENYA                     |   1994 | 468564783.523336
 KENYA                     |   1993 | 471228750.364257
 KENYA                     |   1992 | 468888918.065965
 MOROCCO                   |   1998 | 272493464.091087
 MOROCCO                   |   1997 | 471091470.856487
 MOROCCO                   |   1996 | 476680217.927715
 MOROCCO                   |   1995 | 477087115.852063
 MOROCCO                   |   1994 | 478775834.646846
 MOROCCO                   |   1993 | 471265542.354821
 MOROCCO                   |   1992 | 471363500.613964
 MOZAMBIQUE                |   1998 | 273049341.690901
 MOZAMBIQUE                |   1997 | 459131965.986496
 MOZAMBIQUE                |   1996 | 468373163.663188
 MOZAMBIQUE                |   1995 | 459191683.031706
 MOZAMBIQUE                |   1994 |  462367860.92483
 MOZAMBIQUE                |   1993 | 462393278.015118
 MOZAMBIQUE                |   1992 | 458747654.380176
 PERU                      |   1998 | 268750707.258519
 PERU                      |   1997 |  459420705.78346
 PERU                      |   1996 | 461943731.096922
 PERU                      |   1995 | 470534642.799275
 PERU                      |   1994 | 471403883.203949
 PERU                      |   1993 | 468355936.013624
 PERU                      |   1992 | 474743351.238679
 ROMANIA                   |   1998 | 272358422.753242
 ROMANIA                   |   1997 | 464159968.110414
 ROMANIA                   |   1996 | 462973200.040152
 ROMANIA                   |   1995 |  461113833.93395
 ROMANIA                   |   1994 | 467568657.072635
 ROMANIA                   |   1993 | 463322757.039474
 ROMANIA                   |   1992 | 459133212.599842
 RUSSIA                    |   1998 | 273541177.512888
 RUSSIA                    |   1997 | 472853509.623689
 RUSSIA                    |   1996 | 472918469.865056
 RUSSIA                    |   1995 | 463817558.967025
 RUSSIA                    |   1994 | 465190797.853715
 RUSSIA                    |   1993 | 460598096.796015
 RUSSIA                    |   1992 | 473642874.662102
 SAUDI ARABIA              |   1998 | 274465730.733295
 SAUDI ARABIA              |   1997 | 469568462.137658
 SAUDI ARABIA              |   1996 | 466787447.227121
 SAUDI ARABIA              |   1995 | 472042389.480873
 SAUDI ARABIA              |   1994 | 460670542.273518
 SAUDI ARABIA              |   1993 | 464174486.119379
 SAUDI ARABIA              |   1992 |  468880471.16977
 UNITED KINGDOM            |   1998 | 273362416.342838
 UNITED KINGDOM            |   1997 | 470550721.189599
 UNITED KINGDOM            |   1996 | 471837477.824419
 UNITED KINGDOM            |   1995 | 465231503.532848
 UNITED KINGDOM            |   1994 |  463674766.87936
 UNITED KINGDOM            |   1993 | 463151825.899783
 UNITED KINGDOM            |   1992 | 465239064.006708
 UNITED STATES             |   1998 | 269685678.462668
 UNITED STATES             |   1997 | 467259473.973199
 UNITED STATES             |   1996 | 470057971.107793
 UNITED STATES             |   1995 | 473794632.830188
 UNITED STATES             |   1994 |  468453261.86172
 UNITED STATES             |   1993 | 470793308.005768
 UNITED STATES             |   1992 | 463268473.137869
 VIETNAM                   |   1998 | 263863297.184226
 VIETNAM                   |   1997 |  461518686.12746
 VIETNAM                   |   1996 | 476787802.602467
 VIETNAM                   |   1995 | 461526717.859946
 VIETNAM                   |   1994 | 464492481.746209
 VIETNAM                   |   1993 | 466393725.047039
 VIETNAM                   |   1992 | 460863345.834055
(175 rows)

COMMIT;
COMMIT
