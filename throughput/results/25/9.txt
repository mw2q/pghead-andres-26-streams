BEGIN;
BEGIN
select
	nation,
	o_year,
	sum(amount) as sum_profit
from
	(
		select
			n_name as nation,
			extract(year from o_orderdate) as o_year,
			l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
		from
			part,
			supplier,
			lineitem,
			partsupp,
			orders,
			nation
		where
			s_suppkey = l_suppkey
			and ps_suppkey = l_suppkey
			and ps_partkey = l_partkey
			and p_partkey = l_partkey
			and o_orderkey = l_orderkey
			and s_nationkey = n_nationkey
			and p_name like '%steel%'
	) as profit
group by
	nation,
	o_year
order by
	nation,
	o_year desc;
          nation           | o_year |    sum_profit    
---------------------------+--------+------------------
 ALGERIA                   |   1998 | 268824811.065254
 ALGERIA                   |   1997 | 460637979.018936
 ALGERIA                   |   1996 | 465112332.123182
 ALGERIA                   |   1995 | 468812205.399584
 ALGERIA                   |   1994 | 460982018.628641
 ALGERIA                   |   1993 |  466961911.65557
 ALGERIA                   |   1992 | 467059615.540161
 ARGENTINA                 |   1998 | 275400930.358481
 ARGENTINA                 |   1997 | 470993450.290156
 ARGENTINA                 |   1996 | 471208040.613687
 ARGENTINA                 |   1995 |  467642119.06846
 ARGENTINA                 |   1994 | 471222377.587831
 ARGENTINA                 |   1993 | 470581967.226802
 ARGENTINA                 |   1992 | 466335834.030268
 BRAZIL                    |   1998 | 272613524.472422
 BRAZIL                    |   1997 | 460927815.617079
 BRAZIL                    |   1996 | 460473654.253095
 BRAZIL                    |   1995 | 462513782.979349
 BRAZIL                    |   1994 | 465549782.090107
 BRAZIL                    |   1993 | 468310119.160204
 BRAZIL                    |   1992 | 463851155.578148
 CANADA                    |   1998 | 277019467.567508
 CANADA                    |   1997 | 483888093.150096
 CANADA                    |   1996 |  481304565.95599
 CANADA                    |   1995 | 476739504.128491
 CANADA                    |   1994 | 485523880.427218
 CANADA                    |   1993 | 475552177.614103
 CANADA                    |   1992 | 476663260.072812
 CHINA                     |   1998 | 274054534.575343
 CHINA                     |   1997 | 469750090.097618
 CHINA                     |   1996 | 468249571.993948
 CHINA                     |   1995 | 461278058.864774
 CHINA                     |   1994 | 466704174.967876
 CHINA                     |   1993 | 469054085.752693
 CHINA                     |   1992 | 466451409.164546
 EGYPT                     |   1998 | 277268642.722671
 EGYPT                     |   1997 | 465519269.683283
 EGYPT                     |   1996 | 468447483.857088
 EGYPT                     |   1995 | 465442836.036957
 EGYPT                     |   1994 | 463272463.949757
 EGYPT                     |   1993 | 473690642.369204
 EGYPT                     |   1992 | 464058101.126324
 ETHIOPIA                  |   1998 | 270976810.025308
 ETHIOPIA                  |   1997 | 462643621.516334
 ETHIOPIA                  |   1996 | 453260377.371944
 ETHIOPIA                  |   1995 |  459362190.54951
 ETHIOPIA                  |   1994 | 467284198.393423
 ETHIOPIA                  |   1993 | 451371245.273052
 ETHIOPIA                  |   1992 |  470580182.04573
 FRANCE                    |   1998 | 271154953.034342
 FRANCE                    |   1997 | 463813332.207251
 FRANCE                    |   1996 | 467865482.622504
 FRANCE                    |   1995 | 465430433.228309
 FRANCE                    |   1994 | 465097609.661935
 FRANCE                    |   1993 | 469681021.161006
 FRANCE                    |   1992 | 472080794.254824
 GERMANY                   |   1998 | 273130821.861511
 GERMANY                   |   1997 | 465926165.535322
 GERMANY                   |   1996 | 471597346.075705
 GERMANY                   |   1995 | 469892230.240789
 GERMANY                   |   1994 | 467190191.490374
 GERMANY                   |   1993 | 468913734.736029
 GERMANY                   |   1992 | 468453642.017552
 INDIA                     |   1998 | 277037706.907564
 INDIA                     |   1997 | 469585032.796244
 INDIA                     |   1996 | 473832987.394057
 INDIA                     |   1995 | 463609393.562135
 INDIA                     |   1994 | 470351916.345332
 INDIA                     |   1993 | 467706540.857071
 INDIA                     |   1992 | 466148558.341574
 INDONESIA                 |   1998 | 278249768.370315
 INDONESIA                 |   1997 | 467816974.573753
 INDONESIA                 |   1996 | 467953967.481212
 INDONESIA                 |   1995 | 468602609.193892
 INDONESIA                 |   1994 | 464532335.552978
 INDONESIA                 |   1993 | 473810632.998774
 INDONESIA                 |   1992 | 460656435.705264
 IRAN                      |   1998 | 267191845.122907
 IRAN                      |   1997 | 465127307.617919
 IRAN                      |   1996 | 456841373.123474
 IRAN                      |   1995 | 458760692.402142
 IRAN                      |   1994 | 458201226.606732
 IRAN                      |   1993 | 457584249.580229
 IRAN                      |   1992 | 463377989.817831
 IRAQ                      |   1998 | 274959611.726763
 IRAQ                      |   1997 | 472550205.914995
 IRAQ                      |   1996 | 477790147.406455
 IRAQ                      |   1995 |  471083437.09502
 IRAQ                      |   1994 | 468469752.724544
 IRAQ                      |   1993 | 483913401.002652
 IRAQ                      |   1992 | 478295780.307077
 JAPAN                     |   1998 |  269249660.47212
 JAPAN                     |   1997 | 467839388.985172
 JAPAN                     |   1996 |  469094040.17994
 JAPAN                     |   1995 | 468741252.363317
 JAPAN                     |   1994 | 467936323.911949
 JAPAN                     |   1993 | 476247505.606977
 JAPAN                     |   1992 | 472819127.394301
 JORDAN                    |   1998 | 269534944.626944
 JORDAN                    |   1997 | 454692621.110899
 JORDAN                    |   1996 | 456384777.215676
 JORDAN                    |   1995 | 459581638.106272
 JORDAN                    |   1994 | 458424332.783243
 JORDAN                    |   1993 | 457208185.526349
 JORDAN                    |   1992 | 455495062.907197
 KENYA                     |   1998 | 280074324.575856
 KENYA                     |   1997 | 480946254.460221
 KENYA                     |   1996 | 481556735.896178
 KENYA                     |   1995 | 472124329.346304
 KENYA                     |   1994 | 468862548.717037
 KENYA                     |   1993 | 473573080.722284
 KENYA                     |   1992 |  470248182.96589
 MOROCCO                   |   1998 | 274231181.131077
 MOROCCO                   |   1997 | 475628933.719291
 MOROCCO                   |   1996 | 469072378.619263
 MOROCCO                   |   1995 | 472474904.176546
 MOROCCO                   |   1994 | 473106487.916604
 MOROCCO                   |   1993 |  473632246.46905
 MOROCCO                   |   1992 | 475685456.635009
 MOZAMBIQUE                |   1998 | 277644400.737473
 MOZAMBIQUE                |   1997 | 460786935.416054
 MOZAMBIQUE                |   1996 | 464043324.806051
 MOZAMBIQUE                |   1995 | 465909894.161404
 MOZAMBIQUE                |   1994 | 467150679.882835
 MOZAMBIQUE                |   1993 | 465663075.666435
 MOZAMBIQUE                |   1992 | 457673892.690832
 PERU                      |   1998 | 274452800.872217
 PERU                      |   1997 | 467534967.601705
 PERU                      |   1996 | 467917084.433206
 PERU                      |   1995 | 463198242.857228
 PERU                      |   1994 | 466000088.011341
 PERU                      |   1993 | 465258778.177332
 PERU                      |   1992 | 471383576.527876
 ROMANIA                   |   1998 | 276028044.563172
 ROMANIA                   |   1997 |  477497516.50747
 ROMANIA                   |   1996 | 470912155.406439
 ROMANIA                   |   1995 | 470759691.887473
 ROMANIA                   |   1994 | 470093659.590605
 ROMANIA                   |   1993 | 470766880.173597
 ROMANIA                   |   1992 | 474642529.563177
 RUSSIA                    |   1998 | 268717502.794508
 RUSSIA                    |   1997 | 467543242.471429
 RUSSIA                    |   1996 | 476566414.667646
 RUSSIA                    |   1995 | 470967432.085224
 RUSSIA                    |   1994 | 466727126.512259
 RUSSIA                    |   1993 | 472098969.463762
 RUSSIA                    |   1992 | 465314693.760906
 SAUDI ARABIA              |   1998 | 272818194.047997
 SAUDI ARABIA              |   1997 |  473557974.12961
 SAUDI ARABIA              |   1996 | 472600994.461708
 SAUDI ARABIA              |   1995 | 468376680.020609
 SAUDI ARABIA              |   1994 | 468207028.959804
 SAUDI ARABIA              |   1993 | 467843533.756286
 SAUDI ARABIA              |   1992 | 468952419.428482
 UNITED KINGDOM            |   1998 |  263612095.96234
 UNITED KINGDOM            |   1997 | 467511312.023966
 UNITED KINGDOM            |   1996 | 472253549.063506
 UNITED KINGDOM            |   1995 | 463058413.816607
 UNITED KINGDOM            |   1994 | 462595693.129119
 UNITED KINGDOM            |   1993 | 463249551.453481
 UNITED KINGDOM            |   1992 | 468537210.427608
 UNITED STATES             |   1998 | 280992594.228125
 UNITED STATES             |   1997 | 479619749.469499
 UNITED STATES             |   1996 | 469921678.670618
 UNITED STATES             |   1995 | 470451361.150509
 UNITED STATES             |   1994 | 468338389.905523
 UNITED STATES             |   1993 | 472176114.774077
 UNITED STATES             |   1992 | 471983164.979534
 VIETNAM                   |   1998 | 277047827.489006
 VIETNAM                   |   1997 | 467195686.828262
 VIETNAM                   |   1996 | 474629997.789503
 VIETNAM                   |   1995 | 468245990.914702
 VIETNAM                   |   1994 |  468566994.34968
 VIETNAM                   |   1993 |  466576793.07732
 VIETNAM                   |   1992 | 462203781.561993
(175 rows)

COMMIT;
COMMIT
