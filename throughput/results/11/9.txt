BEGIN;
BEGIN
select
	nation,
	o_year,
	sum(amount) as sum_profit
from
	(
		select
			n_name as nation,
			extract(year from o_orderdate) as o_year,
			l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
		from
			part,
			supplier,
			lineitem,
			partsupp,
			orders,
			nation
		where
			s_suppkey = l_suppkey
			and ps_suppkey = l_suppkey
			and ps_partkey = l_partkey
			and p_partkey = l_partkey
			and o_orderkey = l_orderkey
			and s_nationkey = n_nationkey
			and p_name like '%sandy%'
	) as profit
group by
	nation,
	o_year
order by
	nation,
	o_year desc;
          nation           | o_year |    sum_profit    
---------------------------+--------+------------------
 ALGERIA                   |   1998 | 272365890.743848
 ALGERIA                   |   1997 | 453212515.513936
 ALGERIA                   |   1996 | 456671270.109548
 ALGERIA                   |   1995 | 465725201.971995
 ALGERIA                   |   1994 | 451399198.093079
 ALGERIA                   |   1993 | 461998944.273752
 ALGERIA                   |   1992 | 460848278.116888
 ARGENTINA                 |   1998 | 271213262.145312
 ARGENTINA                 |   1997 |  466802886.96091
 ARGENTINA                 |   1996 | 464154393.075432
 ARGENTINA                 |   1995 | 461893549.831908
 ARGENTINA                 |   1994 | 468610773.375148
 ARGENTINA                 |   1993 | 464800024.873784
 ARGENTINA                 |   1992 | 465275194.538561
 BRAZIL                    |   1998 | 274869223.998538
 BRAZIL                    |   1997 | 473773073.770067
 BRAZIL                    |   1996 | 462384785.120867
 BRAZIL                    |   1995 | 465280571.467029
 BRAZIL                    |   1994 | 468777257.083335
 BRAZIL                    |   1993 | 468646299.649664
 BRAZIL                    |   1992 | 471401734.436798
 CANADA                    |   1998 |  278292153.88594
 CANADA                    |   1997 |  483268132.89114
 CANADA                    |   1996 | 479469787.910859
 CANADA                    |   1995 | 487414524.464139
 CANADA                    |   1994 | 489999031.247834
 CANADA                    |   1993 | 479972610.578289
 CANADA                    |   1992 | 480341277.757892
 CHINA                     |   1998 | 275142037.962072
 CHINA                     |   1997 | 463401081.866575
 CHINA                     |   1996 | 461843931.146988
 CHINA                     |   1995 | 468674895.421924
 CHINA                     |   1994 | 465984747.490122
 CHINA                     |   1993 | 465829758.408133
 CHINA                     |   1992 | 466820200.286592
 EGYPT                     |   1998 | 270191850.568256
 EGYPT                     |   1997 | 462688182.296896
 EGYPT                     |   1996 | 465439077.975079
 EGYPT                     |   1995 | 472260528.772458
 EGYPT                     |   1994 | 463155539.438177
 EGYPT                     |   1993 | 469715880.419654
 EGYPT                     |   1992 | 471735156.953831
 ETHIOPIA                  |   1998 | 266511455.570638
 ETHIOPIA                  |   1997 | 457168087.199158
 ETHIOPIA                  |   1996 | 455978410.325255
 ETHIOPIA                  |   1995 | 457283803.418595
 ETHIOPIA                  |   1994 | 457636320.056641
 ETHIOPIA                  |   1993 | 457006714.836648
 ETHIOPIA                  |   1992 | 471628869.263227
 FRANCE                    |   1998 | 275842646.399343
 FRANCE                    |   1997 | 466250073.676108
 FRANCE                    |   1996 | 465845155.096827
 FRANCE                    |   1995 | 473890084.564334
 FRANCE                    |   1994 | 463305822.508176
 FRANCE                    |   1993 | 461208581.278808
 FRANCE                    |   1992 | 460284088.056454
 GERMANY                   |   1998 | 274787973.062594
 GERMANY                   |   1997 | 480465289.958216
 GERMANY                   |   1996 |  479000828.81942
 GERMANY                   |   1995 | 472497192.535095
 GERMANY                   |   1994 | 471803783.824939
 GERMANY                   |   1993 | 480523326.013951
 GERMANY                   |   1992 | 475520267.541615
 INDIA                     |   1998 | 284956403.089402
 INDIA                     |   1997 | 479501078.872731
 INDIA                     |   1996 | 473625845.132676
 INDIA                     |   1995 | 475413884.166272
 INDIA                     |   1994 | 479658399.147448
 INDIA                     |   1993 | 477672077.771929
 INDIA                     |   1992 | 475256784.913045
 INDONESIA                 |   1998 | 267775984.848707
 INDONESIA                 |   1997 | 455916287.668768
 INDONESIA                 |   1996 | 459302543.879673
 INDONESIA                 |   1995 | 449931889.851253
 INDONESIA                 |   1994 | 459105258.920608
 INDONESIA                 |   1993 | 451576409.818862
 INDONESIA                 |   1992 | 453265195.397338
 IRAN                      |   1998 | 271387187.431245
 IRAN                      |   1997 | 468675505.057909
 IRAN                      |   1996 |  472123470.83547
 IRAN                      |   1995 | 464364673.832415
 IRAN                      |   1994 | 473478005.554954
 IRAN                      |   1993 | 467583907.888919
 IRAN                      |   1992 | 467811404.661188
 IRAQ                      |   1998 | 275646756.961539
 IRAQ                      |   1997 | 472963153.789893
 IRAQ                      |   1996 | 473016094.434789
 IRAQ                      |   1995 | 479814492.302782
 IRAQ                      |   1994 | 472671169.039538
 IRAQ                      |   1993 | 471845642.928069
 IRAQ                      |   1992 | 474952289.763431
 JAPAN                     |   1998 | 272155841.443694
 JAPAN                     |   1997 | 464575333.927044
 JAPAN                     |   1996 | 464429019.729886
 JAPAN                     |   1995 | 469345852.327848
 JAPAN                     |   1994 | 466200200.831845
 JAPAN                     |   1993 | 464154506.017086
 JAPAN                     |   1992 |  470122676.57999
 JORDAN                    |   1998 |  264604359.49718
 JORDAN                    |   1997 | 453077077.410333
 JORDAN                    |   1996 | 455997132.730599
 JORDAN                    |   1995 | 454025258.244887
 JORDAN                    |   1994 | 459359044.218176
 JORDAN                    |   1993 | 465643353.062714
 JORDAN                    |   1992 | 460768812.604846
 KENYA                     |   1998 | 273337866.558053
 KENYA                     |   1997 | 468945808.759399
 KENYA                     |   1996 | 469877348.364981
 KENYA                     |   1995 | 468976437.852369
 KENYA                     |   1994 |  470395184.11737
 KENYA                     |   1993 | 467608617.057019
 KENYA                     |   1992 | 468279799.962906
 MOROCCO                   |   1998 | 277640961.936446
 MOROCCO                   |   1997 | 473180243.246463
 MOROCCO                   |   1996 | 470304816.933692
 MOROCCO                   |   1995 | 472574547.495492
 MOROCCO                   |   1994 | 474891523.901865
 MOROCCO                   |   1993 | 468090197.028894
 MOROCCO                   |   1992 |   461775310.0024
 MOZAMBIQUE                |   1998 | 273077284.883375
 MOZAMBIQUE                |   1997 | 452653149.140522
 MOZAMBIQUE                |   1996 | 452187558.507583
 MOZAMBIQUE                |   1995 | 454736832.435429
 MOZAMBIQUE                |   1994 | 459305473.843152
 MOZAMBIQUE                |   1993 | 450930636.917662
 MOZAMBIQUE                |   1992 | 453494689.601705
 PERU                      |   1998 | 266405108.611075
 PERU                      |   1997 | 455280758.100769
 PERU                      |   1996 | 461443991.236685
 PERU                      |   1995 | 462978495.485089
 PERU                      |   1994 | 470882521.065702
 PERU                      |   1993 | 457816802.687914
 PERU                      |   1992 | 467011146.330744
 ROMANIA                   |   1998 | 272216449.174098
 ROMANIA                   |   1997 | 460698542.669078
 ROMANIA                   |   1996 | 461309867.331964
 ROMANIA                   |   1995 |  462865609.30189
 ROMANIA                   |   1994 | 458292871.781524
 ROMANIA                   |   1993 | 455882637.027344
 ROMANIA                   |   1992 | 472143000.619741
 RUSSIA                    |   1998 | 270646058.266237
 RUSSIA                    |   1997 | 468050472.765998
 RUSSIA                    |   1996 | 489292655.429515
 RUSSIA                    |   1995 | 474297257.976602
 RUSSIA                    |   1994 | 478679636.050966
 RUSSIA                    |   1993 | 474368610.644126
 RUSSIA                    |   1992 |  478893964.62056
 SAUDI ARABIA              |   1998 |  274501039.09048
 SAUDI ARABIA              |   1997 | 471511770.619612
 SAUDI ARABIA              |   1996 | 469315783.192955
 SAUDI ARABIA              |   1995 | 468876597.045776
 SAUDI ARABIA              |   1994 | 464963662.097401
 SAUDI ARABIA              |   1993 | 467600115.351524
 SAUDI ARABIA              |   1992 | 471936262.789657
 UNITED KINGDOM            |   1998 | 274909323.206356
 UNITED KINGDOM            |   1997 | 471037353.349376
 UNITED KINGDOM            |   1996 | 473858584.160409
 UNITED KINGDOM            |   1995 | 464085922.885019
 UNITED KINGDOM            |   1994 | 470189527.403613
 UNITED KINGDOM            |   1993 |  468711630.66177
 UNITED KINGDOM            |   1992 | 470784298.683676
 UNITED STATES             |   1998 | 277021574.702458
 UNITED STATES             |   1997 | 473318740.599504
 UNITED STATES             |   1996 | 479010323.771383
 UNITED STATES             |   1995 | 473678632.506961
 UNITED STATES             |   1994 | 477466073.519215
 UNITED STATES             |   1993 | 480107660.686086
 UNITED STATES             |   1992 | 472593928.355237
 VIETNAM                   |   1998 | 270123122.643982
 VIETNAM                   |   1997 | 455647387.579232
 VIETNAM                   |   1996 | 464918596.952578
 VIETNAM                   |   1995 | 458428986.395987
 VIETNAM                   |   1994 | 457293847.526622
 VIETNAM                   |   1993 | 462273315.850197
 VIETNAM                   |   1992 | 459103737.779019
(175 rows)

COMMIT;
COMMIT
